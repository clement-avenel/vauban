<% content_for :title, "#{@document.title} - Vauban Demo" %>

<div style="margin-bottom: 1rem;">
  <%= link_to "â† Back to Documents", documents_path, style: "color: #007bff; text-decoration: none;" %>
</div>

<div style="border: 1px solid #ddd; border-radius: 4px; padding: 2rem; background: white;">
  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
    <div>
      <h1 style="margin: 0 0 0.5rem 0;"><%= @document.title %></h1>
      <div style="color: #666; font-size: 0.9rem;">
        <p style="margin: 0.25rem 0;">
          <strong>Owner:</strong> <%= @document.owner.name || @document.owner.email %>
        </p>
        <p style="margin: 0.25rem 0;">
          <strong>Status:</strong>
          <% if @document.public? %>
            <span style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.875rem;">Public</span>
          <% else %>
            <span style="background: #6c757d; color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.875rem;">Private</span>
          <% end %>
          <% if @document.archived? %>
            <span style="background: #ffc107; color: #000; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.875rem; margin-left: 0.5rem;">Archived</span>
          <% end %>
        </p>
        <% if @document.collaborators.any? %>
          <p style="margin: 0.25rem 0;">
            <strong>Collaborators:</strong> <%= @document.collaborators.map { |c| c.name || c.email }.join(", ") %>
          </p>
        <% end %>
      </div>
    </div>
    <div style="display: flex; gap: 0.5rem;">
      <% if can?(:edit, @document) %>
        <%= link_to "Edit", edit_document_path(@document), style: "padding: 0.5rem 1rem; background: #ffc107; color: #000; text-decoration: none; border-radius: 4px;" %>
      <% end %>
      <% if can?(:delete, @document) %>
        <%= link_to "Delete", @document, method: :delete, 
            data: { confirm: "Are you sure you want to delete this document?" },
            style: "padding: 0.5rem 1rem; background: #dc3545; color: white; text-decoration: none; border-radius: 4px;" %>
      <% end %>
    </div>
  </div>

  <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
    <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">Your Permissions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
      <div>
        <strong>View:</strong> 
        <span style="color: <%= can?(:view, @document) ? '#28a745' : '#dc3545' %>">
          <%= can?(:view, @document) ? 'âœ… Allowed' : 'âŒ Denied' %>
        </span>
      </div>
      <div>
        <strong>Edit:</strong> 
        <span style="color: <%= can?(:edit, @document) ? '#28a745' : '#dc3545' %>">
          <%= can?(:edit, @document) ? 'âœ… Allowed' : 'âŒ Denied' %>
        </span>
      </div>
      <div>
        <strong>Delete:</strong> 
        <span style="color: <%= can?(:delete, @document) ? '#28a745' : '#dc3545' %>">
          <%= can?(:delete, @document) ? 'âœ… Allowed' : 'âŒ Denied' %>
        </span>
      </div>
    </div>
  </div>

  <% if @document.content.present? %>
    <div style="margin-top: 1.5rem;">
      <h2 style="margin: 0 0 1rem 0; font-size: 1.25rem;">Content</h2>
      <div style="white-space: pre-wrap; line-height: 1.6;"><%= @document.content %></div>
    </div>
  <% else %>
    <p style="color: #666; font-style: italic;">No content yet.</p>
  <% end %>
</div>

<div style="background: #e7f3ff; padding: 1rem; border-radius: 4px; margin-top: 2rem; border-left: 4px solid #007bff;">
  <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">ðŸ’¡ How Authorization Works</h3>
  <p style="margin: 0; font-size: 0.9rem; color: #333;">
    This page demonstrates Vauban's authorization:
  </p>
  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; font-size: 0.9rem;">
    <li>The <code>show</code> action calls <code>authorize! :view, @document</code> which raises <code>Vauban::Unauthorized</code> if you can't view</li>
    <li>The view uses <code>can?(:edit, @document)</code> to conditionally show the Edit button</li>
    <li>The view uses <code>can?(:delete, @document)</code> to conditionally show the Delete button</li>
    <li>Try switching users to see how permissions change!</li>
  </ul>
</div>
